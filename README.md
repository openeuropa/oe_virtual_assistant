# OpenEuropa Virtual Assistant

This module integrates the Virtual Assistant with the OpenEuropa platform.

## Setup

To get started with this project, ensure you have the following tools installed on your machine:

- [Docker](https://www.docker.com/get-docker)
- [Docker Compose](https://docs.docker.com/compose/)

Once these are ready, set up the project by running:

```shell
make
```

This command will:

1. Generate a Git-ignored [`docker-compose.override.yml`](docker-compose.override.yml) file.
2. Start the Docker containers in production mode.
3. Build and install the target site, accessible at [http://127.0.0.1:8080](http://127.0.0.1:8080).

A post-command hook (`drupal:site-setup`) is automatically triggered after running `composer install`. This hook symlinks
the module to the appropriate directory within the test site and substitutes tokens in the test configuration files.

**Note:** Project files and directories are symlinked within the test site using the
[OpenEuropa Task Runner's Drupal project symlink](https://github.com/openeuropa/task-runner-drupal-project-symlink) command.

If you add a new file or directory to the root of the project, you must re-run `drupal:site-setup` to ensure proper symlinking.

To avoid a full site setup, you can instead run:

```shell
./vendor/bin/run drupal:symlink-project
```

Additional [`Makefile`](Makefile) targets include:

```shell
$ make help
 dev            : Set up development files like ".env" and "docker-compose.override.yml".
 help           : Display available commands.
 build          : Build the site without installing it. Also runs "dev" and "up".
 install        : Install the target site. Also runs "build".
 build-docker   : (Re)build the Docker image and start the containers.
 up             : Start the containers.
 shell          : Access the `web` container via shell.
```

## Development

The [`Dockerfile`](Dockerfile) for this project includes a `dev` target that installs and enables `xdebug`. To use this,
ensure your [`docker-compose.override.yml`](docker-compose.override.yml) is configured as follows:

```yaml
services:
  web:
    build:
      context: .
      target: dev
#      target: base
```

Rebuild the container by running:

```shell
make build-docker
```

### Running Tests

To run GrumPHP checks:

```bash
docker compose exec web grumphp run
```

To run PHPUnit tests:

```bash
docker compose exec web phpunit
```

### Step Debugging

To enable step debugging from the command line, pass the `XDEBUG_SESSION` environment variable with any value to the container:

```bash
docker compose exec -e XDEBUG_SESSION=1 web <your command>
```

**Note:** Starting with XDebug 3, a connection error message will appear in the console if the `XDEBUG_SESSION` variable
is set but your client is not listening for debugging connections. This message may cause false negatives in PHPUnit tests.

To initiate step debugging from the browser, set the appropriate cookie using a browser extension or a bookmarklet, such
as those generated by [JetBrains PhpStorm](https://www.jetbrains.com/phpstorm/marklets/).

## Contributing

Please read [the full documentation](https://github.com/openeuropa/openeuropa) for our code of conduct and instructions on how to submit pull requests.

## Versioning

We use [Semantic Versioning (SemVer)](http://semver.org/). For available versions, see the [tags on this repository](https://github.com/openeuropa/oe_translation/tags).
